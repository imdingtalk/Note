<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>snoopy</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content><meta name=generator content="Hugo 0.83.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/dingtalk.pub/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><link href=dingtalk.pub/post/index.xml rel=alternate type=application/rss+xml title=snoopy><link href=dingtalk.pub/post/index.xml rel=feed type=application/rss+xml title=snoopy><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="dingtalk.pub/post/"><meta itemprop=name content="Posts"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content></head><body class="ma0 avenir bg-near-white"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=dingtalk.pub/ class="f3 fw2 hover-white no-underline white-90 dib">snoopy</a><div class="flex-l items-center"></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">Posts</h1></div></div></header><main class=pb7 role=main><article class="pa3 pa4-ns nested-copy-line-height nested-img"><section class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray"></section><aside class="flex-ns flex-wrap justify-around mt5"><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>June 9, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/45240324/ class="link black dim">ubuntu 配置 clash</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">安装 下载最新版本 clash：https://github.com/Dreamacro/clash/releases​
自己的阿里云网盘存档一份： https://www.aliyundrive.com/​ 初始化执行clash ./clash 配置文件参考 https://github.com/Dreamacro/clash/wiki/configuration注意配置控制台端口号Web 配置端口号9090可以从配置文件的external-controller找到
port: 7890 socks-port: 7891 allow-lan: true mode: Rule log-level: info external-controller: :9090 proxies: .... .... 使用 Web 工具管理 clash web端管理地址： http://clash.razord.top/#/proxies​配置开机自启动 sudo vim /usr/lib/systemd/system/clash.service [Unit] Description=clash After=network.target [Service] ExecStart=/usr/bin/nohup /home/biao/soft/clash -f /home/biao/soft/ss.yaml & User=biao [Install] WantedBy=multi-user.target 自启动 sudo systemctl start clash sudo systemctl enable clash</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>April 16, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/43680688/ class="link black dim">nerdctl 小探</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">介绍 Nerdctl是一个用于Containerd的Docker兼容的CLI 安装和使用 https://github.com/containerd/nerdctl/releases 特性 lazy-pulling  安装 Stargz 插件 (containerd-stargz-grpc) >https://github.com/containerd/stargz-snapshotter #/etc/systemd/system/stargz.service [Unit] Description=BuildKit Documentation=https://github.com/moby/buildkit [Service] ExecStart=/usr/local/bin/containerd-stargz-grpc [Install] WantedBy=multi-user.target systemctl enable stargz 给conrainerd添加如下配置 /etc/containerd/config.toml
[proxy_plugins] [proxy_plugins.stargz] type = "snapshot" address = "/run/containerd-stargz-grpc/containerd-stargz-grpc.sock" #配合k8s使用 >https://github.com/containerd/stargz-snapshotter#quick-start-with-kubernetes# 测试
# 重启一下 containerd 和 containerd-stargz-grpc systemctl restart containerd.service systemctl restart stargz.service # 尝试拉取一个镜像 #使用stargz root@biao:/tmp# nerdctl --snapshotter=stargz pull ghcr.io/stargz-containers/fedora:30-esgz ghcr.io/stargz-containers/fedora:30-esgz: resolved |++++++++++++++++++++++++++++++++++++++| index-sha256:a4d6c9d2a329aa83d4ffbc1e2bb1fb423c6920ee930afb4aba01b2fecb575b53: done |++++++++++++++++++++++++++++++++++++++| manifest-sha256:36a9dc91f23e6baa88a59b7d657b0a16640d38c6cecaee659bd9dfeeec98ac5f: done |++++++++++++++++++++++++++++++++++++++| config-sha256:f42ed93c71d834aad9dc6892078a452d1c3e4968db206b74f111123bb6efd65e: done |++++++++++++++++++++++++++++++++++++++| elapsed: 5.</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>March 25, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/33602495/ class="link black dim">[go笔记] new 和 make</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">new 返回类型的指针，指向类型的指针地址，置为该类型的0值make 返回类型本身，用于map,slice,chan值类型会直接分配内存，引用类型需要申请内存Each element of such a variable or value is set to the zero value for its type: false for booleans, 0 for numeric types, "" for strings, and nil for pointers, functions, interfaces, slices, channels, and maps
在使用make()函数创建切片时，如果我们能够预计出合理的容量大小（太大浪费内存空间，太小会不断的扩容），哪么我们在进行切片的append时，可能不会发生扩容，也就避免了切片元素的复制，减少了开销。
n2 := new([]int) fmt.Println("result", &n2,n2, *n2) //new 切片,0值为[] fmt.Println(len(*n2), cap(*n2)) n3:=make([]int,3,6) fmt.Println("result",n3)</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>March 23, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/6554913/ class="link black dim">kubeadm集群证书管理相关</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">检查证书过期时间 Kubelet使用证书对Kubernetes API进行身份验证。默认情况下，这些证书的有效期为一年，因此不需要太频繁地更新它们。
#对应1.15以上的kubeadm集群 kubeadm alpha certs check-expiration #其他集群 openssl x509 -noout -dates -in /etc/kubernetes/pki/*.crt 证书到期的影响 1. kubectl 不可用 [root@biao ~]# date -s "2022-06-25 20:13:00" Sat Jun 25 20:13:00 CST 2022 [root@biao ~]# kubectl get pod Unable to connect to the server: x509: certificate has expired or is not yet valid 2. 系统相关的组件，etcd,kube-controller-manager,kube-scheduler通通不可用，集群全面崩溃 # 查看日志信息，是在证书更新后使用新的kubeconfig文件来查看的 [root@biao kubernetes]# kubectl logs -n kube-system etcd-biao Error from server (InternalError): Internal error occurred: Authorization error (user=kube-apiserver-kubelet-client, verb=get, resource=nodes, subresource=proxy) [root@biao kubernetes]# kubectl logs -n kube-system kube-controller-manager-biao Error from server (InternalError): Internal error occurred: Authorization error (user=kube-apiserver-kubelet-client, verb=get, resource=nodes, subresource=proxy [root@biao kubernetes]# kubectl logs -n kube-system kube-scheduler-biao Error from server (InternalError): Internal error occurred: Authorization error (user=kube-apiserver-kubelet-client, verb=get, resource=nodes, subresource=proxy) [root@biao kubernetes]# kubectl logs -n kube-system kube-apiserver-biao Error from server (InternalError): Internal error occurred: Authorization error (user=kube-apiserver-kubelet-client, verb=get, resource=nodes, subresource=proxy) 证书更新以及相关更新 #更新所有的证书 #准备集群配置文件 kubeadm config view > /tmp/cluster.</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>March 15, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/29816377/ class="link black dim">配置对Harbor的HTTPS访问</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">生成证书颁发机构证书 在生产环境中，应该从CA获得证书。在测试或开发环境中，可以生成自己的CA。要生成CA证书，运行以下命令。
生成CA证书私钥。 openssl genrsa -out ca.key 4096 生成CA证书。调整-subj选项中的值以反映您的组织。如果使用FQDN连接Harbor主机，则必须将其指定为通用名称（CN）属性。 CN=yourdomain.com openssl req -x509 -new -nodes -sha512 -days 3650 \ -subj "/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=$CN" \ -key ca.key \ -out ca.crt 生成服务器证书 证书通常包含一个.crt文件和一个.key文件，例如yourdomain.com.crt和yourdomain.com.key。
生成私钥。 openssl genrsa -out $CN.key 4096 生成证书签名请求（CSR）。调整-subj选项中的值以反映您的组织。如果使用FQDN连接Harbor主机，则必须将其指定为公用名（CN）属性，并在密钥和CSR文件名中使用它。 openssl req -sha512 -new \ -subj "/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=$CN" \ -key $CN.key \ -out $CN.csr 生成一个x509 v3扩展文件。无论您使用FQDN还是IP地址连接到Harbor主机，都必须创建此文件，以便可以为您的Harbor主机生成符合主题备用名称（SAN）和x509 v3的证书扩展要求。替换DNS条目以反映您的域。 cat > v3.ext &lt;&lt;-EOF authorityKeyIdentifier=keyid,issuer basicConstraints=CA:FALSE keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment extendedKeyUsage = serverAuth subjectAltName = @alt_names [alt_names] DNS.</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>March 10, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/32630466/ class="link black dim">小试linkerd</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">介绍 Linkerd是Kubernetes的_服务网格_。通过提供运行时调试，可观察性，可靠性和安全性，它使运行服务变得更加轻松和安全，而所有这些都无需更改代码。 安装 安装cli To install the CLI manually, run:
curl -sL https://run.linkerd.io/install | sh  add linkerd to your path with:
export PATH=$PATH:$HOME/.linkerd2/bin 验证Kubernetes集群 linkerd check --pre 将Linkerd安装到集群上 linkerd install | kubectl apply -f - #通过运行以下命令来验证安装： linkerd check 访问dashboard linkerd dashboard & 应用 怎么给应用注入
kubectl get -n emojivoto deploy -o yaml \ | linkerd inject - \ | kubectl apply -f - 观察应用
linkerd -n emojivoto stat deploy 它给应用带来了什么 ，默认的mTLS linkerd -n linkerd edges deployment linkerd -n linkerd tap deploy</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>March 10, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/32642359/ class="link black dim">cert-manager 的安装和使用</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">介绍 cert-manager是本地Kubernetes证书管理控制器。它可以帮助从各种来源颁发证书，例如Let&rsquo;s Encrypt， HashiCorp Vault， Venafi，简单的签名密钥对或自签名。它将确保证书有效并且是最新的，并在到期前尝试在配置的时间续订证书。 安装 首次安装 $ helm repo add jetstack https://charts.jetstack.io $ helm repo update $ helm install \ cert-manager jetstack/cert-manager \ --namespace cert-manager \ --version v1.2.0 \ --create-namespace \ # --set installCRDs=true 升级 $ helm upgrade --version &lt;version> &lt;release_name> jetstack/cert-manager 使用</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>February 26, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/32005266/ class="link black dim">helm 中如何拼接一个变量</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">使用 定义一个变量
{{ define "makeServiceNamespace" }} {{- if .Values.serviceTag }} {{- printf "%s-%s" .Values.serviceNamespace .Values.serviceTag -}} {{- else }} {{- print .Values.serviceNamespace }} {{- end }} {{- end }} 使用该变量
serviceNamespace: {{ template makeServiceNamespace . }} 参考 https://stackoverflow.com/questions/45278655/kubernetes-helm-combine-two-variables-with-a-string-in-the-middle</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>January 6, 2021</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/29696468/ class="link black dim">falco</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">falco是什么？ falco项目是最初由Sysdig，Inc构建的开源运行时安全工具。Falco被捐赠给CNCF，现在是CNCF孵化项目。 falco做什么？ Falco通过以下方式使用系统调用来保护和监视系统：
在运行时从内核解析Linux系统调用 针对强大的规则引擎声明流 违反规则时发出警报 安装 curl -s https://falco.org/repo/falcosecurity-3672BA8F.asc | apt-key add - echo "deb https://dl.bintray.com/falcosecurity/deb stable main" | tee -a /etc/apt/sources.list.d/falcosecurity.list apt-get update -y apt-get -y install linux-headers-$(uname -r) apt-get install -y falco 配置</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>December 4, 2020</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/3593792/ class="link black dim">k8s中的强制删除-pod or namespace</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">1. 强制删除 kubectl delete namespace &lt;NAMESPACE> --force --grace-period=0 2. 使用API操作 kubectl proxy & NAMESPACE=monitoring kubectl get namespace $NAMESPACE -o json |jq '.spec = {"finalizers":[]}' >temp.json curl -k -H "Content-Type: application/json" -X PUT --data-binary @temp.json 127.0.0.1:8001/api/v1/namespaces/$NAMESPACE/finalize 3. 在etcd中删除 查看
ETCDCTL_API=3 etcdctl get /registry/namespaces --prefix --keys-only \ --cert /etc/kubernetes/pki/etcd/peer.crt \ --key /etc/kubernetes/pki/etcd/peer.key \ --cacert /etc/kubernetes/pki/etcd/ca.crt 删除
ETCDCTL_API=3 etcdctl del /registry/namespaces/&lt;NAMESPACE> \ --cert /etc/kubernetes/pki/etcd/peer.crt \ --key /etc/kubernetes/pki/etcd/peer.key \ --cacert /etc/kubernetes/pki/etcd/ca.crt Pod同理</div></div></div></aside><ul class=pagination><li class=page-item><a href=dingtalk.pub/post/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class="page-item disabled"><a class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class="page-item active"><a class=page-link href=dingtalk.pub/post/>1</a></li><li class=page-item><a class=page-link href=dingtalk.pub/post/page/2/>2</a></li><li class=page-item><a class=page-link href=dingtalk.pub/post/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=dingtalk.pub/post/page/8/>8</a></li><li class=page-item><a href=dingtalk.pub/post/page/2/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=dingtalk.pub/post/page/8/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=dingtalk.pub>&copy; snoopy 2021</a><div></div></div></footer></body></html>