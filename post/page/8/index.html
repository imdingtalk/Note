<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>snoopy</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content><meta name=generator content="Hugo 0.83.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/dingtalk.pub/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><link href=dingtalk.pub/post/index.xml rel=alternate type=application/rss+xml title=snoopy><link href=dingtalk.pub/post/index.xml rel=feed type=application/rss+xml title=snoopy><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="dingtalk.pub/post/"><meta itemprop=name content="Posts"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content></head><body class="ma0 avenir bg-near-white"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=dingtalk.pub/ class="f3 fw2 hover-white no-underline white-90 dib">snoopy</a><div class="flex-l items-center"></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">Posts</h1></div></div></header><main class=pb7 role=main><article class="pa3 pa4-ns nested-copy-line-height nested-img"><section class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray"></section><aside class="flex-ns flex-wrap justify-around mt5"><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>January 30, 2019</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/1201722/ class="link black dim">k8s DaemonSet 介绍和使用</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">一个_DaemonSet_确保所有（或部分）节点上运行pod的副本，随着节点添加到群集中，将添加Pod。随着节点从群集中删除，这些Pod将被垃圾回收清理，删除DaemonSet将清除它创建的Pod。
DaemonSet的一些典型用法是：  在每个节点上运行 集群存储后台daemon，例如glusterd，ceph。 在每个节点上运行日志收集守护程序，例如fluentd或logstash。 在每个节点上运行节点监控守护进程，比如 Prometheus Node Exporte 在一个简单的例子中，覆盖所有节点的一个DaemonSet将用于每种类型的守护进程。更复杂的设置可能会为单一类型的守护程序使用多个DaemonSet，但对不同的硬件类型使用不同的flags 和/或 不同的内存和CPU请求。
编写DaemonSet 创建一个守护进程集 在yaml文件中描述daemonSet,一个运行fluentd-elasticsearch Docker的yaml文件如下：
apiVersion: apps/v1 kind: DaemonSet metadata: name: fluentd-elasticsearch namespace: kube-system labels: k8s-app: fluentd-logging spec: selector: matchLabels: name: fluentd-elasticsearch template: metadata: labels: name: fluentd-elasticsearch spec: tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule containers: - name: fluentd-elasticsearch image: k8s.gcr.io/fluentd-elasticsearch:1.20 resources: limits: memory: 200Mi requests: cpu: 100m memory: 200Mi volumeMounts: - name: varlog mountPath: /var/log - name: varlibdockercontainers mountPath: /var/lib/docker/containers readOnly: true terminationGracePeriodSeconds: 30 volumes: - name: varlog hostPath: path: /var/log - name: varlibdockercontainers hostPath: path: /var/lib/docker/containers 基于YAML文件创建DaemonSet: kubectl create -f daemonset.</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>January 20, 2019</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/1164321/ class="link black dim">安装和配置kubectl</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">配置源 配置国内的阿里源CentOS / RHEL / Fedora :
cat &lt;&lt;EOF > /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/ enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF setenforce 0 Debian / Ubuntu :
apt-get update && apt-get install -y apt-transport-https curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF >/etc/apt/sources.list.d/kubernetes.list deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main EOF apt-get update 安装 Debian / Ubuntu :
apt-get install -y kubelet CentOS / RHEL / Fedora :
yum install -y kubelet 或者使用二进制包：
# 获取最新二进制包： curl -LO https://storage.</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>January 20, 2019</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/1164280/ class="link black dim">解决使用Travis过程中报Permission denied的问题</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">问题描述 在尝试使用Travis来同步谷歌的仓库过程中，使用自己写的脚本，想要添加阿里云的k8s源，遇到报错如下:解决  需要在 travis.yml 文件开头加上 sudo: required 并且在需要执行的命令前加上sudo</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><div class=f6>January 17, 2019</div><h1 class="f3 near-black"><a href=dingtalk.pub/post/1147591/ class="link black dim">PV的回收策略小探</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">介绍 回收策略一般在PV或者storageclass中申明，主要有三种策略：Delete Retain Recycle 实践 一个典型的PV申明如下
apiVersion: v1 kind: PersistentVolume metadata: name: nfspv spec: capacity: storage: 2Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Retain nfs: path: /data/nfs server: 127.0.0.1 此处挂载的是本地的nfs服务器，为了配合测试建立相应的PVC如下：
apiVersion: v1 kind: PersistentVolumeClaim metadata: name: nfspvc spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Giya 执行以上两个yaml：
kubectl apply -f nfs-pv.yaml kubectl apply -f nfs-pvc.yaml # 查看pvc或者pvc可以看到他们已经绑定 [root@node1 test]# kubectl get pv NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE nfspv 2Gi RWO Retain Bound default/nfspvc 11s # 可以看到名字为nfspvc的pvc申明需要的空间为1Gi，k8s自动匹配最相近的PV，所以匹配了名字 # 为nfspv的PV,提供了2Gi存储空间，满足了PVC的要求。 使用一个POD来使用这PVC：</div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><h1 class="f3 near-black"><a href=dingtalk.pub/post/1530018/ class="link black dim">无标题</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height"></div></div></div><div class="relative w-100 w-30-l mb4 bg-white"><div class="mb3 pa4 mid-gray overflow-hidden"><h1 class="f3 near-black"><a href=dingtalk.pub/post/2782554/ class="link black dim">无标题</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height"></div></div></div></aside><ul class=pagination><li class=page-item><a href=dingtalk.pub/post/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=dingtalk.pub/post/page/7/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=dingtalk.pub/post/>1</a></li><li class=page-item><a class=page-link href=dingtalk.pub/post/page/2/>2</a></li><li class=page-item><a class=page-link href=dingtalk.pub/post/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=dingtalk.pub/post/page/7/>7</a></li><li class="page-item active"><a class=page-link href=dingtalk.pub/post/page/8/>8</a></li><li class="page-item disabled"><a class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=dingtalk.pub/post/page/8/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=dingtalk.pub>&copy; snoopy 2021</a><div></div></div></footer></body></html>