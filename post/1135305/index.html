<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>GitHub+Travis CI+hexo构建个人博客 | snoopy</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="参考文档:Hexo 博客终极玩法：云端写作，自动部署使用Hexo+Github+TravisCI搭建自动发布的静态博客系统Hexo遇上Travis-CI：可能是最通俗易懂的自动发布博客图文教程
基本参考以上的文章做了完整的一套，此处不再赘诉，以下说下几个坑的地方：
 要使用 https://imdingtalk.github.io/ 这种以自己的用户GitHub用户名做域名（不用这种的话，可以使用自己的域名）的话，必须使用master分支做为展示页面。前面教程基本都是用master分支来做hexo源码存放路径的。搞得我后来把仓库名改成 <username>.github.io 之后，自动构建了半天结果页面还是404 。查看设置页面才知道有这坑，但是我前面已经将源码目录和生成后的页面分别放在了master和gh-pages，Google半天也不知道怎么搜索去切换master和gh-pages，自己摸索了下，抱着试一试的心态把远程仓库全部删除了。重新传了下代码解决。仅供参考  做以下操作前，需要先关闭travis-ci的自动构建，避免push了删除的操作后，触发构建，导致代码混乱# 从远端下载最新的代码,进入代码目录 git clone xxx.git cd xxx # 切换到主分支并备份主分支 git checkout master mkdir ../master \cp -rf * ../master # 切换到gh-pages分支并备份该分支 git checkout gh-pages mkdir ../ghpages \cp -rf * ../ghpages # 目录备份完成，直接删除远程仓库代码 git rm -rf * git commit -m &#34;delete gh-pages&#34; git push origin gh-pages git checkout master git rm -rf * git commit -m &#34;delete master&#34; git push origin master # 以上就删除了远端目录，接下来把备份的gh-pages推到master，备份的master推送到gh-pages # change master to gh-pages cd ."><meta name=generator content="Hugo 0.83.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/dingtalk.pub/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css><meta property="og:title" content="GitHub+Travis CI+hexo构建个人博客"><meta property="og:description" content="参考文档:Hexo 博客终极玩法：云端写作，自动部署使用Hexo+Github+TravisCI搭建自动发布的静态博客系统Hexo遇上Travis-CI：可能是最通俗易懂的自动发布博客图文教程
基本参考以上的文章做了完整的一套，此处不再赘诉，以下说下几个坑的地方：
 要使用 https://imdingtalk.github.io/ 这种以自己的用户GitHub用户名做域名（不用这种的话，可以使用自己的域名）的话，必须使用master分支做为展示页面。前面教程基本都是用master分支来做hexo源码存放路径的。搞得我后来把仓库名改成 <username>.github.io 之后，自动构建了半天结果页面还是404 。查看设置页面才知道有这坑，但是我前面已经将源码目录和生成后的页面分别放在了master和gh-pages，Google半天也不知道怎么搜索去切换master和gh-pages，自己摸索了下，抱着试一试的心态把远程仓库全部删除了。重新传了下代码解决。仅供参考  做以下操作前，需要先关闭travis-ci的自动构建，避免push了删除的操作后，触发构建，导致代码混乱# 从远端下载最新的代码,进入代码目录 git clone xxx.git cd xxx # 切换到主分支并备份主分支 git checkout master mkdir ../master \cp -rf * ../master # 切换到gh-pages分支并备份该分支 git checkout gh-pages mkdir ../ghpages \cp -rf * ../ghpages # 目录备份完成，直接删除远程仓库代码 git rm -rf * git commit -m &#34;delete gh-pages&#34; git push origin gh-pages git checkout master git rm -rf * git commit -m &#34;delete master&#34; git push origin master # 以上就删除了远端目录，接下来把备份的gh-pages推到master，备份的master推送到gh-pages # change master to gh-pages cd ."><meta property="og:type" content="article"><meta property="og:url" content="dingtalk.pub/post/1135305/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-03-31T08:01:54+00:00"><meta property="article:modified_time" content="2019-03-31T08:01:54+00:00"><meta itemprop=name content="GitHub+Travis CI+hexo构建个人博客"><meta itemprop=description content="参考文档:Hexo 博客终极玩法：云端写作，自动部署使用Hexo+Github+TravisCI搭建自动发布的静态博客系统Hexo遇上Travis-CI：可能是最通俗易懂的自动发布博客图文教程
基本参考以上的文章做了完整的一套，此处不再赘诉，以下说下几个坑的地方：
 要使用 https://imdingtalk.github.io/ 这种以自己的用户GitHub用户名做域名（不用这种的话，可以使用自己的域名）的话，必须使用master分支做为展示页面。前面教程基本都是用master分支来做hexo源码存放路径的。搞得我后来把仓库名改成 <username>.github.io 之后，自动构建了半天结果页面还是404 。查看设置页面才知道有这坑，但是我前面已经将源码目录和生成后的页面分别放在了master和gh-pages，Google半天也不知道怎么搜索去切换master和gh-pages，自己摸索了下，抱着试一试的心态把远程仓库全部删除了。重新传了下代码解决。仅供参考  做以下操作前，需要先关闭travis-ci的自动构建，避免push了删除的操作后，触发构建，导致代码混乱# 从远端下载最新的代码,进入代码目录 git clone xxx.git cd xxx # 切换到主分支并备份主分支 git checkout master mkdir ../master \cp -rf * ../master # 切换到gh-pages分支并备份该分支 git checkout gh-pages mkdir ../ghpages \cp -rf * ../ghpages # 目录备份完成，直接删除远程仓库代码 git rm -rf * git commit -m &#34;delete gh-pages&#34; git push origin gh-pages git checkout master git rm -rf * git commit -m &#34;delete master&#34; git push origin master # 以上就删除了远端目录，接下来把备份的gh-pages推到master，备份的master推送到gh-pages # change master to gh-pages cd ."><meta itemprop=datePublished content="2019-03-31T08:01:54+00:00"><meta itemprop=dateModified content="2019-03-31T08:01:54+00:00"><meta itemprop=wordCount content="400"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="GitHub+Travis CI+hexo构建个人博客"><meta name=twitter:description content="参考文档:Hexo 博客终极玩法：云端写作，自动部署使用Hexo+Github+TravisCI搭建自动发布的静态博客系统Hexo遇上Travis-CI：可能是最通俗易懂的自动发布博客图文教程
基本参考以上的文章做了完整的一套，此处不再赘诉，以下说下几个坑的地方：
 要使用 https://imdingtalk.github.io/ 这种以自己的用户GitHub用户名做域名（不用这种的话，可以使用自己的域名）的话，必须使用master分支做为展示页面。前面教程基本都是用master分支来做hexo源码存放路径的。搞得我后来把仓库名改成 <username>.github.io 之后，自动构建了半天结果页面还是404 。查看设置页面才知道有这坑，但是我前面已经将源码目录和生成后的页面分别放在了master和gh-pages，Google半天也不知道怎么搜索去切换master和gh-pages，自己摸索了下，抱着试一试的心态把远程仓库全部删除了。重新传了下代码解决。仅供参考  做以下操作前，需要先关闭travis-ci的自动构建，避免push了删除的操作后，触发构建，导致代码混乱# 从远端下载最新的代码,进入代码目录 git clone xxx.git cd xxx # 切换到主分支并备份主分支 git checkout master mkdir ../master \cp -rf * ../master # 切换到gh-pages分支并备份该分支 git checkout gh-pages mkdir ../ghpages \cp -rf * ../ghpages # 目录备份完成，直接删除远程仓库代码 git rm -rf * git commit -m &#34;delete gh-pages&#34; git push origin gh-pages git checkout master git rm -rf * git commit -m &#34;delete master&#34; git push origin master # 以上就删除了远端目录，接下来把备份的gh-pages推到master，备份的master推送到gh-pages # change master to gh-pages cd ."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=dingtalk.pub/ class="f3 fw2 hover-white no-underline white-90 dib">snoopy</a><div class="flex-l items-center"></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=dingtalk.pub/dingtalk.pub/post/1135305/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=dingtalk.pub/dingtalk.pub/post/1135305/&text=GitHub+Travis%20CI+hexo%e6%9e%84%e5%bb%ba%e4%b8%aa%e4%ba%ba%e5%8d%9a%e5%ae%a2" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=dingtalk.pub/dingtalk.pub/post/1135305/&title=GitHub+Travis%20CI+hexo%e6%9e%84%e5%bb%ba%e4%b8%aa%e4%ba%ba%e5%8d%9a%e5%ae%a2" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">GitHub+Travis CI+hexo构建个人博客</h1><time class="f6 mv4 dib tracked" datetime=2019-03-31T08:01:54Z>March 31, 2019</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>参考文档:<a href>Hexo 博客终极玩法：云端写作，自动部署</a><a href=https://segmentfault.com/a/1190000013266001>使用Hexo+Github+TravisCI搭建自动发布的静态博客系统</a><a href=https://juejin.im/post/5a1fa30c6fb9a045263b5d2a>Hexo遇上Travis-CI：可能是最通俗易懂的自动发布博客图文教程</a></p><p>基本参考以上的文章做了完整的一套，此处不再赘诉，以下说下几个坑的地方：</p><ol><li>要使用 <a href=https://imdingtalk.github.io/>https://imdingtalk.github.io/</a> 这种以自己的用户GitHub用户名做域名（不用这种的话，可以使用自己的域名）的话，必须使用master分支做为展示页面。前面教程基本都是用master分支来做hexo源码存放路径的。搞得我后来把仓库名改成  <code>&lt;username>.github.io</code>  之后，自动构建了半天结果页面还是404 。查看设置页面才知道有这坑，但是我前面已经将源码目录和生成后的页面分别放在了master和gh-pages，Google半天也不知道怎么搜索去切换master和gh-pages，自己摸索了下，抱着试一试的心态把远程仓库全部删除了。重新传了下代码解决。仅供参考<img src=/images/1135305_1.png alt=image.png></li></ol><p>做以下操作前，需要先<strong>关闭travis-ci</strong>的自动构建，避免push了删除的操作后，触发构建，导致代码混乱<img src=/images/1135305_2.png alt=image.png></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 从远端下载最新的代码,进入代码目录</span>
git clone xxx.git
cd  xxx
<span style=color:#75715e># 切换到主分支并备份主分支</span>
git  checkout master
mkdir  ../master
<span style=color:#ae81ff>\c</span>p -rf * ../master
<span style=color:#75715e># 切换到gh-pages分支并备份该分支</span>
git checkout gh-pages
mkdir  ../ghpages
<span style=color:#ae81ff>\c</span>p -rf * ../ghpages
<span style=color:#75715e>#  目录备份完成，直接删除远程仓库代码</span>
git  rm -rf  *
git commit -m <span style=color:#e6db74>&#34;delete gh-pages&#34;</span>
git push origin gh-pages
git checkout master 
git  rm -rf  *
git commit -m <span style=color:#e6db74>&#34;delete master&#34;</span>
git push origin master
<span style=color:#75715e># 以上就删除了远端目录，接下来把备份的gh-pages推到master，备份的master推送到gh-pages</span>
<span style=color:#75715e># change  master to gh-pages</span>
cd ../master
git init
git remote add origin  git@github.com:imdingtalk/imdingtalk.github.io.git 
git add -A
git commit -m <span style=color:#e6db74>&#34;change  master to gh-pages&#34;</span>
git push origin gh-pages  --force <span style=color:#75715e>#这里必须加 --force 否则会提示要首先同步远程仓库,远程仓库在前面的操作中已经删完了，千万别同步下来了</span>
<span style=color:#75715e>#  change   gh-pages to master </span>
cd ghpages 
git init
git remote add origin  git@github.com:imdingtalk/imdingtalk.github.io.git
<span style=color:#75715e># 本地创建新分支</span>
git branch  -b gh-pages
git add -A
git commit -m <span style=color:#e6db74>&#34;change gh-pages to  master &#34;</span>
git push origin gh-pages  --force
</code></pre></div><p>以上，便完成了分支的转换，应该有更方便的办法，我没找到，献丑啦。这样改需要对应的修改hexo的 <code>_config.yml</code>  和 <code>.travis.yml</code>   </p><p><code>.travis.yml</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>branches</span>:
  <span style=color:#f92672>only</span>:
  - <span style=color:#ae81ff>gh-pages</span>
</code></pre></div><p><code>_config.yml</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>deploy</span>:
  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>git</span>
  <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>https://GH_TOKEN@github.com/imdingtalk/imdingtalk.github.io.git</span>
  <span style=color:#f92672>branch</span>: <span style=color:#ae81ff>master</span>
</code></pre></div><p>确认无误后打开Travis CI的自动构建</p><h3 id=其他>其他</h3><p>获取Travis的仓库id，在serverless的时候使用  </p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -L http://api.travis-ci.org/repos/imdingtalk/imdingtalk.github.io
</code></pre></div><p><img src=/images/1135305_3.png alt=image.png>将以上获取的信息添加到无服务函数作为参数  </p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main_handler</span>($event, $context) {
    <span style=color:#75715e>// 解析语雀post的数据
</span><span style=color:#75715e></span>    $update_title <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
    <span style=color:#66d9ef>if</span>($event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>body</span>){
        $yuque_data<span style=color:#f92672>=</span> <span style=color:#a6e22e>json_decode</span>($event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>body</span>);
        $update_title <span style=color:#f92672>.=</span> $yuque_data<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>title</span>;
    }
    <span style=color:#75715e>// default params
</span><span style=color:#75715e></span>    $repos <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;imdingtalk%2FBlog&#39;</span>;  <span style=color:#75715e>// 你的仓库id 或 slug  这里%2F代替imdingtalk/Blog中的/或替换为返回结果中的id 8575778
</span><span style=color:#75715e></span>    $token <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;a-pHmOiaVy8RUXKXm5fWYQ&#39;</span>; <span style=color:#75715e>// 你的登录token,travis的token
</span><span style=color:#75715e></span>    $message <span style=color:#f92672>=</span> <span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#34;Y/m/d&#34;</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;:yuque update:&#39;</span><span style=color:#f92672>.</span>$update_title;
    $branch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;master&#39;</span>;
    <span style=color:#75715e>// post params
</span><span style=color:#75715e></span>    $queryString <span style=color:#f92672>=</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>queryString</span>;
    $q_token <span style=color:#f92672>=</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token</span> <span style=color:#f92672>?</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token</span> <span style=color:#f92672>:</span> $token;
    $q_repos <span style=color:#f92672>=</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>repos</span> <span style=color:#f92672>?</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>repos</span> <span style=color:#f92672>:</span> $repos;
    $q_message <span style=color:#f92672>=</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>message</span> <span style=color:#f92672>?</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>message</span> <span style=color:#f92672>:</span> $message;
    $q_branch <span style=color:#f92672>=</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>branch</span> <span style=color:#f92672>?</span> $queryString<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>branch</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;master&#39;</span>;
    <span style=color:#66d9ef>echo</span>($q_token);
    <span style=color:#66d9ef>echo</span>(<span style=color:#e6db74>&#39;===&#39;</span>);
    <span style=color:#66d9ef>echo</span> ($q_repos);
    <span style=color:#66d9ef>echo</span> (<span style=color:#e6db74>&#39;===&#39;</span>);
    <span style=color:#66d9ef>echo</span> ($q_message);
    <span style=color:#66d9ef>echo</span> (<span style=color:#e6db74>&#39;===&#39;</span>);
    <span style=color:#66d9ef>echo</span> ($q_branch);
    <span style=color:#66d9ef>echo</span> (<span style=color:#e6db74>&#39;===&#39;</span>);
    <span style=color:#75715e>//request travis ci
</span><span style=color:#75715e></span>    $res_info <span style=color:#f92672>=</span> <span style=color:#a6e22e>triggerTravisCI</span>($q_repos, $q_token, $q_message, $q_branch);
    <span style=color:#66d9ef>echo</span> ($res_info);
    $res_code <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    $res_message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;未知&#39;</span>;
    <span style=color:#66d9ef>if</span>($res_info[<span style=color:#e6db74>&#39;http_code&#39;</span>]){
        $res_code <span style=color:#f92672>=</span> $res_info[<span style=color:#e6db74>&#39;http_code&#39;</span>];
        <span style=color:#66d9ef>switch</span>($res_info[<span style=color:#e6db74>&#39;http_code&#39;</span>]){
            <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>200</span><span style=color:#f92672>:</span>
            <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>202</span><span style=color:#f92672>:</span>
                $res_message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;success&#39;</span>;
            <span style=color:#66d9ef>break</span>;
            <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
                $res_message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;faild&#39;</span>;
            <span style=color:#66d9ef>break</span>;
        }
    }
    $res <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
        <span style=color:#e6db74>&#39;status&#39;</span><span style=color:#f92672>=&gt;</span>$res_code,
        <span style=color:#e6db74>&#39;message&#39;</span><span style=color:#f92672>=&gt;</span>$res_message
    );
    <span style=color:#66d9ef>return</span> $res;
}

<span style=color:#75715e>/*
</span><span style=color:#75715e>* @description  travis api , trigger a build
</span><span style=color:#75715e>* @param $repos string 仓库ID、slug
</span><span style=color:#75715e>* @param $token string 登录验证token
</span><span style=color:#75715e>* @param $message string 触发信息
</span><span style=color:#75715e>* @param $branch string 分支
</span><span style=color:#75715e>* @return $info array 回包信息
</span><span style=color:#75715e>*/</span>
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>triggerTravisCI</span> ($repos, $token, $message<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;yuque update&#39;</span>, $branch<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;gh-pages&#39;</span>) {
    <span style=color:#75715e>//初始化
</span><span style=color:#75715e></span>    $curl <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_init</span>();
    <span style=color:#75715e>//设置抓取的url
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>curl_setopt</span>($curl, <span style=color:#a6e22e>CURLOPT_URL</span>, <span style=color:#e6db74>&#39;https://api.travis-ci.com/repo/&#39;</span><span style=color:#f92672>.</span>$repos<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/requests&#39;</span>);
    <span style=color:#75715e>//设置获取的信息以文件流的形式返回，而不是直接输出。
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>curl_setopt</span>($curl, <span style=color:#a6e22e>CURLOPT_RETURNTRANSFER</span>, <span style=color:#ae81ff>1</span>);
    <span style=color:#75715e>//设置post方式提交
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>curl_setopt</span>($curl, <span style=color:#a6e22e>CURLOPT_CUSTOMREQUEST</span>, <span style=color:#e6db74>&#34;POST&#34;</span>);
    <span style=color:#75715e>//设置post数据
</span><span style=color:#75715e></span>    $post_data <span style=color:#f92672>=</span> <span style=color:#a6e22e>json_encode</span>(<span style=color:#66d9ef>array</span>(
        <span style=color:#e6db74>&#34;request&#34;</span><span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(
            <span style=color:#e6db74>&#34;message&#34;</span><span style=color:#f92672>=&gt;</span>$message,
            <span style=color:#e6db74>&#34;branch&#34;</span><span style=color:#f92672>=&gt;</span>$branch
        )
    ));
    $header <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
      <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span>,
      <span style=color:#e6db74>&#39;Travis-API-Version: 3&#39;</span>,
      <span style=color:#e6db74>&#39;Authorization:token &#39;</span><span style=color:#f92672>.</span>$token,
      <span style=color:#e6db74>&#39;Content-Length:&#39;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>strlen</span>($post_data)
    );
    <span style=color:#a6e22e>curl_setopt</span>($curl, <span style=color:#a6e22e>CURLOPT_HTTPHEADER</span>, $header);
    <span style=color:#a6e22e>curl_setopt</span>($curl, <span style=color:#a6e22e>CURLOPT_POSTFIELDS</span>, $post_data);
    <span style=color:#75715e>//执行命令
</span><span style=color:#75715e></span>    $data <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_exec</span>($curl);
    $info <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_getinfo</span>($curl);
    <span style=color:#75715e>//关闭URL请求
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>curl_close</span>($curl);
    <span style=color:#66d9ef>return</span> $info;
}
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=dingtalk.pub>&copy; snoopy 2021</a><div></div></div></footer></body></html>